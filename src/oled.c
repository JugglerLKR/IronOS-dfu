#include "oled.h"

uint8_t oled_init_array[] = {
    // Every line is a pair of init terms
    0x80, 0xAE, /*Display off*/
    0x80, 0xD5, /*Set display clock divide ratio / osc freq*/
    0x80, 0x52, /*Divide ratios*/
    0x80, 0xA8, /*Set Multiplex Ratio*/
    0x80, 0x0F, /*16 == max brightness,39==dimmest*/
    0x80, 0xC0, /*Set COM Scan direction*/
    0x80, 0xD3, /*Set vertical Display offset*/
    0x80, 0x00, /*0 Offset*/
    0x80, 0x40, /*Set Display start line to 0*/
    0x80, 0xA0, /*Set Segment remap to normal*/
    0x80, 0x8D, /*Charge Pump*/
    0x80, 0x14, /*Charge Pump settings*/
    0x80, 0xDA, /*Set VCOM Pins hardware config*/
    0x80, 0x02, /*Combination 2*/
    0x80, 0x81, /*Brightness*/
    0x80, 0x00, /*^0*/
    0x80, 0xD9, /*Set pre-charge period*/
    0x80, 0xF1, /*Pre charge period*/
    0x80, 0xDB, /*Adjust VCOMH regulator ouput*/
    0x80, 0x30, /*VCOM level*/
    0x80, 0xA4, /*Enable the display GDDR*/
    0x80, 0XA6, /*Normal display*/
    0x80, 0x20, /*Memory Mode*/
    0x80, 0x00, /*Wrap memory*/
    0x80, 0xAF, /*Display on*/
};

const uint8_t oled_framebuffer[] = {
    // Set display ON:
    0x80,
    0xAF, // cmd

    // Set column address:
    //  A[6:0] - Column start address = 0x20
    //  B[6:0] - Column end address = 0x7F
    0x80,
    0x21, // cmd
    0x80,
    0x20, // A
    0x80,
    0x7F, // B

    // Set COM output scan direction (normal mode, COM0 to COM[N-1])
    0x80,
    0xC0,

    // Set page address:
    //  A[2:0] - Page start address = 0
    //  B[2:0] - Page end address = 1
    0x80,
    0x22, // cmd
    0x80,
    0x00, // A
    0x80,
    0x01, // B

    // Start of data
    0x40,

    // DATAATTA
    // width = 84
    // height = 16
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0xe0,
    0x18,
    0x04,
    0x02,
    0x02,
    0x01,
    0x01,
    0x01,
    0x01,
    0x01,
    0x01,
    0x01,
    0x81,
    0xbd,
    0x81,
    0x01,
    0x01,
    0xfd,
    0x01,
    0x01,
    0x71,
    0x55,
    0x71,
    0x01,
    0x01,
    0x01,
    0x01,
    0x01,
    0x01,
    0x01,
    0x02,
    0x02,
    0x04,
    0x18,
    0xe0,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0xe0,
    0x18,
    0x04,
    0x02,
    0x02,
    0x01,
    0x01,
    0x01,
    0x01,
    0x01,
    0x01,
    0x01,
    0x01,
    0x01,
    0x01,
    0x01,
    0x01,
    0x01,
    0x19,
    0x25,
    0xc1,
    0x01,
    0x19,
    0x25,
    0xc1,
    0x01,
    0x31,
    0x49,
    0x81,
    0x01,
    0x02,
    0x02,
    0x04,
    0x18,
    0xe0,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    //
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x07,
    0x18,
    0x20,
    0x40,
    0x40,
    0x80,
    0x80,
    0x80,
    0x80,
    0x80,
    0x80,
    0x80,
    0x83,
    0xba,
    0x83,
    0x80,
    0x8e,
    0xaa,
    0x8e,
    0x80,
    0x80,
    0xbf,
    0x80,
    0x80,
    0x80,
    0x80,
    0x80,
    0x80,
    0x80,
    0x80,
    0x40,
    0x40,
    0x20,
    0x18,
    0x07,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x07,
    0x18,
    0x22,
    0x4a,
    0x46,
    0x8a,
    0xa6,
    0x8a,
    0xa6,
    0x8a,
    0xa6,
    0x8a,
    0xa6,
    0x8e,
    0xa6,
    0x8e,
    0xa6,
    0x8e,
    0xa6,
    0x8e,
    0xbe,
    0x80,
    0xae,
    0x94,
    0x8c,
    0x94,
    0x88,
    0x8a,
    0x89,
    0x80,
    0x40,
    0x40,
    0x20,
    0x18,
    0x07,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
};

void oled_init(void) {
  const int len = sizeof(oled_init_array) / 2;
  for (int i = 0; i < len; i++) {
    i2c_write_reg(DEVICEADDR_OLED, oled_init_array[i * 2],
                  oled_init_array[(i * 2) + 1]);
  }
  // init should be done now :)
}
void oled_draw_logo(void) {
  // We pre-bake the buffer and commands
  i2c_write_bulk(DEVICEADDR_OLED, sizeof(oled_framebuffer), oled_framebuffer);
}